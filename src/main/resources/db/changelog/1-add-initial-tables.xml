<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.4.xsd">

    <changeSet id="create_city_table" author="vyshnikova">
        <createTable tableName="city">
            <column name="id" type="bigint(20)" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="name" type="varchar(50)" />
        </createTable>
    </changeSet>

    <changeSet id="create_district_table" author="vyshnikova">
        <createTable tableName="district">
            <column name="id" type="bigint(20)" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="name" type="varchar(100)" />
            <column name="city_id" type="bigint(20)" >
                <constraints
                        referencedTableName="city"
                        referencedColumnNames="id"
                        foreignKeyName="city_fk_city_id"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="create_role_table" author="vyshnikova">
        <createTable tableName="role">
            <column name="id" type="bigint(3)" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="role" type="varchar(20)" />
        </createTable>
    </changeSet>

    <changeSet id="add_initial_roles" author="vyshnikova">
        <sql>
            insert into role(id, role) values
            (1, "ROLE_SUPER_ADMIN"),
            (2, "ROLE_ADMIN"),
            (3, "ROLE_USER")
        </sql>
    </changeSet>

    <changeSet id="create_user_tables" author="vyshnikova">
        <createTable tableName="user">
            <column name="id" type="bigint(20)" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="name" type="varchar(50)" />
            <column name="surname" type="varchar(50)" />
            <column name="patronymic" type="varchar(50)" />
            <column name="email" type="varchar(50)">
                <constraints nullable="false"/>
            </column>
            <column name="password" type="varchar(255)">
                <constraints nullable="false"/>
            </column>
            <column name="address" type="varchar(255)" />
            <column name="birthdate" type="date" />
            <column name="gender" type="varchar(255)" />
            <column name="rating" type="double" />
            <column name="enabled" type="boolean" defaultValueBoolean="true" />
            <column name="city_id" type="bigint(20)">
                <constraints
                        referencedTableName="city"
                        referencedColumnNames="id"
                        foreignKeyName="city1_fk_city_id"/>
            </column>
            <column name="district_id" type="bigint(20)">
                <constraints
                        referencedTableName="district"
                        referencedColumnNames="id"
                        foreignKeyName="district1_fk_district_id"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="add_initial_users" author="vyshnikova">
        <insert tableName="user">
            <column name="name" value="Irina" />
            <column name="surname" value="Vyshnikova" />
            <column name="patronymic" value="Alexandrovna" />
            <column name="email" value="irinavyshnikova@gmail.com" />
            <column name="password" value="$2a$10$KuRL4rJZhZdVV4nYVcGOrONdjJ7Pc0gJgB3AcHsgfyzlcq5ifAorq" />
        </insert>
    </changeSet>

    <changeSet id="create_order_status_table" author="vyshnikova">
        <createTable tableName="order_status">
            <column name="id" type="bigint(3)" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="status" type="varchar(30)" />
        </createTable>
    </changeSet>
    <changeSet id="add_initial_order_statuses" author="vyshnikova">
        <sql>
            insert into order_status(id, status) values
            (1, "Requested"),
            (2, "In agreenment"),
            (3, "In safe hands"),
            (4, "Resolved"),
            (5, "Unknown")
        </sql>
    </changeSet>

    <changeSet id="create_animal_category_table" author="vyshnikova">
        <createTable tableName="animal_category">
            <column name="id" type="bigint(3)" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="category" type="varchar(30)" />
        </createTable>
    </changeSet>
    <changeSet id="add_initial_animal_categories" author="vyshnikova">
        <sql>
            insert into animal_category(id, category) values
            (1, "cat"),
            (2, "dog"),
            (3, "fish"),
            (4, "bird"),
            (5, "reptile"),
            (6, "rodent"),
            (7, "exotics")
        </sql>
    </changeSet>

    <changeSet id="create_user_role_table" author="vyshnikova">
        <createTable tableName="user_role">
            <column name="id" type="bigint(20)" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="user_id" type="bigint(20)" />
            <column name="role_id" type="bigint(3)" />
        </createTable>
    </changeSet>

    <changeSet id="add_initial_user_roles" author="vyshnikova">
        <insert tableName="user_role">
            <column name="user_id" value="1" />
            <column name="role_id" value="1" />
        </insert>
    </changeSet>

    <changeSet id="create_pet_table" author="vyshnikova">
        <createTable tableName="pet">
            <column name="id" type="bigint(20)">
                <constraints primaryKey="true"/>
            </column>
            <column name="name" type="varchar(50)" />
            <column name="birthdate" type="date"/>
            <column name="animal_category_id" type="bigint(3)" />
            <column name="owner_id" type="bigint(20)" />
            <column name="keeper_id" type="bigint(20)" />
            <column name="rating" type="double" />
            <column name="description" type="varchar(500)" />
        </createTable>
    </changeSet>

    <changeSet id="create_order_table" author="vyshnikova">
        <createTable tableName="order">
            <column name="id" type="bigint(20)" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="keeper_id" type="bigint(20)">
                <constraints foreignKeyName="user_fk_keeper_id"
                             referencedColumnNames="id"
                             referencedTableName="user"/>
            </column>
            <column name="status_id" type="bigint(3)">
                <constraints foreignKeyName="status_fk_status_id"
                             referencedColumnNames="id"
                             referencedTableName="order_status"/>
            </column>
            <column name="pet_id" type="bigint(20)">
                <constraints foreignKeyName="pet_fk_pet_id"
                             referencedColumnNames="id"
                             referencedTableName="pet"/>
            </column>
            <column name="createdDate" type="date"/>
            <column name="bookingDate" type="date"/>
            <column name="lastModifiedDate" type="date"/>
            <column name="comments" type="varchar(500)"/>
        </createTable>
    </changeSet>


</databaseChangeLog>